{% extends "base.html" %}
{% include "header.html" %}
{% load static %}
{% block main_block %}

    <!--start-single-->
    <div class="single">
        <div class="container">
            <div class="single-top">
                <a href="#"><img class="img-responsive" src="{% static "images/single-1.jpg" %}" alt=" "></a>
                <div class=" single-grid">
                    <h4>{{ post.title }}</h4>
                    <ul class="blog-ic">
                        <li><a href="#"><span> <i style="color: #27568b"
                                                  class="glyphicon glyphicon-user"> </i>Author : {{ postAuthor.username }}</span>
                        </a></li>
                        <li><span><i class="glyphicon glyphicon-time"> </i>{{ post.date }}</span></li>
                        <li><span> <i style="color: crimson" class="glyphicon glyphicon-heart-empty" id="like-icon"
                                      counterl="{{ post.likes }}"> </i>Like {{ post.likes }}</span></li>
                        <li><a href="#"><span> <i style="color: crimson"
                                                  class="glyphicon glyphicon-remove"> </i>disLike {{ post.dislikes }}</span>
                        </a></li>
                    </ul>
                    <p>{{ post.description }}</p>

                </div>


                {#                 comment display                #}
                <div class="comments heading">
                    <h3>Comments</h3>

                    {% for comment in allComments %}

                        <div class="media">
                        <div class="media-left">
                            <a href="#">
                                <img src="{% static "images/si.png" %}" alt="User Photo">
                            </a>
                        </div>


                        <div class="media-body">
                            <h4 class="media-heading"> {{ comment.user.username }}</h4>
                            <p>{{ comment.description }}</p>
                            <a href="" class="replay"><span> <i class="glyphicon glyphicon-share-alt"> </i>replay</span></a>

                            <div class="media">
                                {#                                replay display#}
                                <ul>
                                    {% for rep in replay_comments %}
                                        {% if comment.id == rep.comment_id %}
                                            <li>
                                                <div class="media-left">
                                                    <a href="#">
                                                        <img src="{% static "images/si.png" %}" alt="User Photo">
                                                    </a>
                                                </div>
                                                <div class="media-body">
                                                    <h4 class="media-heading"> {{ rep.user.username }}</h4>
                                                <p>{{ rep.description }}</p>

                                                </div>

                                                {#                              <a href="" class="replay"><span> <i  class="glyphicon glyphicon-share-alt"> </i>replay</span></a>#}
                                            </li>
                                        {% endif %}
                                    {% endfor %}
                                </ul>


                            </div>


                            {# leave a replayhere#}
                            <div class="comment-bottom heading">
                                <div class="col-lg-12">
                                    <div class="col-lg-8">
                                        <form method="POST" action="/blog/single/{{ post.id }}">
                                            {% csrf_token %}
                                            <textarea cols="3" rows="1" name="replay_text" value=" "
                                                      onfocus="this.value='';"
                                                      onblur="if (this.value == '') {this.value = 'Message';}">replay for here</textarea>
                                            <input type="hidden" name="comment_id" value="{{ comment.id }}">
                                            <input name="replyBtn" type="submit" value="replay">
                                        </form>
                                    </div>
                                    <div class="col-lg-4">
                                    </div>
                                </div>

                            </div>

                        </div>
                    {% endfor %}
                    </div>
                </div>


                {#                leave a comment here#}
                <div class="comment-bottom heading">
                    <h3 id="test">Leave a Comment</h3>
                    <div class="col-lg-12">
                        <div class="col-lg-8">
                            <form method="post" action="/blog/single/{{ post.id }}">
                                {% csrf_token %}
                                <textarea cols="20" rows="5" name="comment_text" value=" " onfocus="this.value='';"
                                          onblur="if (this.value == '') {this.value = 'Message';}">Write Your Comment</textarea>
                                <input name="commentBtn" type="submit" value="Comment">
                            </form>
                        </div>
                        <div class="col-lg-4">
                            <div class="comments heading">
                                <h3 class="text-uppercase"> TAGS </h3>
                                <div class="tag-style">
                                    {% for tag in tags %}

                                        <b>{{ tag.tag }}</b>

                                    {% endfor %}
                                </div>

                            </div>

                        </div>


                    </div>

                </div>
            </div>
        </div>
    </div>
{% endblock %}
{% block javascript %}
    <script>
        $(".replay").click(function () {
            $(this).toggle();
        }


        $("#like-icon").click(function () {

            console.log("clicked")
            likecount = $(this).attr("counterl");
            console.log($(this).attr("counterl"));
            $.ajax({
                url: '{% url "single_like" %}',
                type: 'get',
                data: {
                    'likecount': likecount
                },
                dataType: 'json',
                success: function (data) {
                    if (data.is_taken) {
                        alert("A user with this username already exists.");
                    }
                },
                failure: function (data) {
                    alert('Got an error dude');
                }

            });
            console.log("aftter")
        });

    </script>
{% endblock %}
{% include "footer.html" %}
<!--end-single-->
